<div id="farm-labour">
	<div class="ui secondary pointing menu">
	  <a class="item">Home</a>
	  <a class="item">Messages</a>
	  <a class="item active">Friends</a>
	  <div class="right menu">
	    <a class="ui item">Logout </a>
	  </div>
	</div>
	<div class="ui grid">
		<div class="six wide column">
			<div class="ui segment">
				<div class="ui vertical fluid tabular menu">
					<a class="item" v-bind:class="{active: showFarmers}" v-on:click="showFarmers = true">
	        	Farmers
		      </a>
		      <a class="item" v-bind:class="{active: !showFarmers}" v-on:click="showFarmers = false">
		        Labourers
		      </a>
				</div>
			</div>
		</div>
		<div class="ten wide column">
			<transition name="bounce">
				<div id="farmer-list" v-if="showFarmers">
					<div class="ui segment">
						<%= link_to new_organization_farmer_path(@organization) do %>
							<button class="ui button">Create new farmer</button>
						<% end %>
					</div>
					<table-farmer :farmers="farmers"></table-farmer>					
				</div>
			</transition>
			<transition name="bounce">
				<div id="labourer-list" v-if="!showFarmers">
					<div class="ui segment">
						<%= link_to new_organization_labourer_path(@organization) do %>
							<button class="ui button">Create new labourer</button>
						<% end %>
					</div>				
				</div>			
			</transition>
		</div>
	</div>
	<%= render "organizations/farm_labour/farmer_info" %>
</div>

<script type="text/x-template" id="table-farmer">
	<table class="ui selectable celled table">
	  <thead>
	    <tr>
	    	<th>Name</th>
		    <th>Phone</th>
		    <th>Gender</th>
		  </tr>
	  </thead>
	  <tbody>
			<tr v-for="farmer in farmers">
			  <td>
			  	<a :href="'/organizations/'+ farmer.organization_id +'/farmers/' + farmer.id">{{farmer.fname}} {{farmer.lname}}</a> <i class="ui eye icon float-right" @click.prevent="requestSetFarmerInfo(farmer)"></i>
			  </td>
			  <td>{{farmer.phone}}</td>
			  <td>{{farmer.gender}}</td>
			</tr>
		</tbody>
		<tfoot>
		  <tr>
		    <th colspan="3">
		      <div class="ui right floated pagination menu">
		        <a class="icon item">
		          <i class="left chevron icon"></i>
		        </a>
		        <a class="item">1</a>
		        <a class="item">2</a>
		        <a class="item">3</a>
		        <a class="item">4</a>
		        <a class="icon item">
		          <i class="right chevron icon"></i>
		        </a>
		      </div>
		    </th>
		  </tr>
		</tfoot>
	</table>
</script>
 
<script>
		Vue.component('table-farmer', {
		  props: ['farmers'],
		  template: '#table-farmer',
		  methods:{
	      requestSetFarmerInfo(farmer) {
	      	this.$parent.setFarmerInfo(farmer);
	      }
	    } 
		});

		var farm_labour = new Vue({
			el: '#farm-labour',
			data: {
				farmers: [],
				labourers: [],
				farmerInfo: {},
				labourerInfo: {},
				showFarmers: true
			},
			methods: {
				getFarmers: function(){
					var that = this;
					$.ajax({
		  			url: '/organizations/<%= @organization.id %>/farmers.json',
		  			success: function(res){
		  				that.farmers = res
		  			}
		  		})
				},
				setFarmerInfo: function(farmer){
					this.farmerInfo = farmer;
				},
				clearFarmerInfo: function(){
					this.farmerInfo = {};
				}
			},
	    events: {
	     ' setFarmerRequested': function(farmer){
	        this.setFarmerInfo(farmer);
	      }
	    }
		});
		farm_labour.getFarmers();

</script>