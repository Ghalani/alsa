<div id="farm-show" class="green-bg h100p">
  <div id="map" class="w100p h500"></div>
  <div class="pad-lr-20p">
    <div class="card neg-marg-top100 w100p raise-2">
      <div id="farm-info">
        <div class="fab fab-tr raise-3" v-on:click="showEditForm();">
          <i class="ui write icon"></i>
        </div>
        <h2>Farm Information</h2>
        <p class="text2"><%= @farm.name %></p>
        <p class="text15"><%= @farm.size %> Acre(s)</p>
        <% if @farm.farmer %>
          <p><%= @farm.farmer.name %></p>
        <% else %>
          <h3>This farm has no farmer</h3>
        <% end %>
        <p><span class="btn red-bg" v-on:click="showDeleteModal();">Delete</span></p>
      </div>
      <div id="farm-edit" hidden>
        <div class="fab fab-tr raise-3" v-on:click="showEditForm();">
          <i class="arrow left icon"></i>
        </div>
        <h3>Farm edit</h3>
        <%= render 'form' %>
      </div>
    </div>
  </div>
  <div id="farm-delete" class="ui small modal">
    <div class="header">Header</div>
    <div class="content">
      <p>Are you sure you want to delete this farm?</p>
    </div>
    <div class="actions">
      <div class="ui green-bg button" v-on:click="deleteFarm()" >Yes</div>
      <div class="ui red-bg button" v-on:click="showDeleteModal()">No</div>
    </div>
    <p></p>
  </div>
</div>

<script>
  var map;
  var shape;
  function clearShape(){
    if (Boolean(shape)){
      shape.setMap(null);
      farmNew.farmShape = [];
    }
  }

  function createPolygon(shapeArray){
    new google.maps.Polygon({
      map: map,
      paths: shapeArray,
      strokeColor: '#00FF00',
      strokeOpacity: 0.8,
      strokeWeight: 2,
      fillColor: '#00FF00',
      fillOpacity: 0.35
    });
  }

  function initMap() {
    var coord = Boolean(farmNew.farm.points[0]) ? farmNew.farm.points[0] : {lat: -4, lng: 0};
    var zoom = (Boolean(farmNew.farm.points[0]) ? 8 : 3);
    map = new google.maps.Map(document.getElementById('map'), {
      center: coord,
      scrollwheel: false,
      zoom: zoom
    });
    createPolygon(farmNew.farm.points);
  }

  var farmNew = new Vue({
    el: "#farm-show",
    data: {
      farm: <%= @farm.to_json.html_safe %>
    },
    methods: {
      showEditForm: function(){
        var first = $('#farm-edit').is(':visible') ? '#farm-edit' : '#farm-info';
        var second = $('#farm-edit').is(':visible') ? '#farm-info' : '#farm-edit';
        console.log('first: ' + first +", second: " + second);
        $(first).toggle('fast', function(){
          $(second).toggle('fast');
        });
      },
      showDeleteModal: function(){
        $('#farm-delete.modal').modal('toggle');
      },
      deleteFarm: function(){
        $.ajax({
          url: '/organizations/<%= @organization.id %>/farms/<%= @farm.id %>.json',
          method: "DELETE",
          success: function(res){
            if(Boolean(document.referrer)){
              window.location = document.referrer;
            }else{
              window.history.back();
            }

          }, 
          error: function(err){ console.log(err.message)}
        });
      }
    }
  })

</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC2NxLOf_zTbaq0pyoeRLfBFTX4Q55KWuo&libraries=drawing&callback=initMap"
async defer></script>
